<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Shooter Game</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.55.2/phaser.min.js"></script>
    <style>
        body { 
            margin: 0; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            background-color: black; 
            font-family: Arial, sans-serif;
            color: white;
        }
        #game-container { 
            text-align: center; 
        }
        canvas { 
            border: 2px solid cyan; 
            max-width: 100%;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>Space Shooter</h1>
        <div id="phaser-game"></div>
        <p>Controls: Arrow Keys to Move, A/D to Rotate, SPACE to Shoot</p>
    </div>

    <script>
    const WINDOW_WIDTH = window.innerWidth > 800 ? 800 : window.innerWidth - 20;
    const WINDOW_HEIGHT = window.innerHeight > 600 ? 600 : window.innerHeight - 100;

    const config = {
        type: Phaser.AUTO,
        width: WINDOW_WIDTH,
        height: WINDOW_HEIGHT,
        parent: 'phaser-game',
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 0 },
                debug: false
            }
        },
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };

    const game = new Phaser.Game(config);
    let player, cursors, bullets, asteroids;
    let score = 0, scoreText, lives = 3, livesText;

    function preload() {
        // Load images from GitHub Pages relative path
        this.load.image('ship', 'static/player_ship.png');
        this.load.image('asteroid', 'static/asteroid.png');
        this.load.image('bullet', 'static/bullet.png');
    }

    function create() {
        // Background
        this.cameras.main.setBackgroundColor('#000000');

        // Create player
        player = this.physics.add.sprite(WINDOW_WIDTH/2, WINDOW_HEIGHT-100, 'ship');
        player.setCollideWorldBounds(true);

        // Create groups
        bullets = this.physics.add.group();
        asteroids = this.physics.add.group();

        // Keyboard input
        cursors = this.input.keyboard.createCursorKeys();

        // Score and lives text
        scoreText = this.add.text(16, 16, 'Score: 0', { fontSize: '24px', fill: '#fff' });
        livesText = this.add.text(16, 50, 'Lives: 3', { fontSize: '24px', fill: '#fff' });

        // Spawn initial asteroids
        for (let i = 0; i < 5; i++) {
            createAsteroid(this);
        }

        // Collision detection
        this.physics.add.collider(bullets, asteroids, handleBulletAsteroidCollision, null, this);
        this.physics.add.collider(player, asteroids, handlePlayerAsteroidCollision, null, this);
    }

    function update() {
        // Player movement
        player.setVelocity(0);
        if (cursors.left.isDown) {
            player.setVelocityX(-300);
        } else if (cursors.right.isDown) {
            player.setVelocityX(300);
        }

        if (cursors.up.isDown) {
            player.setVelocityY(-300);
        } else if (cursors.down.isDown) {
            player.setVelocityY(300);
        }

        // Shooting
        if (cursors.space.isDown) {
            shootBullet(this);
        }

        // Wrap asteroids around screen
        asteroids.children.entries.forEach(asteroid => {
            if (asteroid.x > WINDOW_WIDTH) asteroid.x = 0;
            if (asteroid.x < 0) asteroid.x = WINDOW_WIDTH;
            if (asteroid.y > WINDOW_HEIGHT) asteroid.y = 0;
            if (asteroid.y < 0) asteroid.y = WINDOW_HEIGHT;
        });
    }

    function createAsteroid(scene) {
        const x = Phaser.Math.Between(0, WINDOW_WIDTH);
        const y = Phaser.Math.Between(0, WINDOW_HEIGHT/2);
        const asteroid = scene.physics.add.sprite(x, y, 'asteroid');
        asteroid.setVelocity(
            Phaser.Math.Between(-100, 100), 
            Phaser.Math.Between(-100, 100)
        );
        asteroids.add(asteroid);
    }

    function shootBullet(scene) {
        // Prevent rapid fire
        if (scene.time.now > (scene.lastBulletTime || 0) + 250) {
            const bullet = scene.physics.add.sprite(player.x, player.y, 'bullet');
            bullet.setVelocityY(-400);
            bullets.add(bullet);
            scene.lastBulletTime = scene.time.now;

            // Remove bullet when out of bounds
            scene.time.delayedCall(2000, () => {
                if (bullet.active) bullet.destroy();
            });
        }
    }

    function handleBulletAsteroidCollision(bullet, asteroid) {
        bullet.destroy();
        asteroid.destroy();
        
        // Increase score
        score += 10;
        scoreText.setText('Score: ' + score);

        // Spawn new asteroid
        createAsteroid(this);

        // Split asteroid (simplified)
        if (Math.random() < 0.5) {
            createAsteroid(this);
        }
    }

    function handlePlayerAsteroidCollision(player, asteroid) {
        asteroid.destroy();
        
        // Reduce lives
        lives--;
        livesText.setText('Lives: ' + lives);

        // Game over check
        if (lives <= 0) {
            this.scene.restart();
            lives = 3;
            score = 0;
        }
    }
    </script>
</body>
</html>
