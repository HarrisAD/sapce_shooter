<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Simple Space Shooter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.55.2/phaser.min.js"></script>
    <style>
        body { 
            margin: 0; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            background-color: black; 
            color: white;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="phaser-game"></div>
    </div>

    <script>
    class SpaceShooterScene extends Phaser.Scene {
        constructor() {
            super('SpaceShooterScene');
            this.lives = 3;
            this.score = 0;
        }

        preload() {
            // Load images
            this.load.image('ship', 'static/player_ship.png');
            this.load.image('asteroid', 'static/asteroid.png');
            this.load.image('bullet', 'static/bullet.png');
        }

        create() {
            // Create physics groups
            this.asteroidsGroup = this.physics.add.group();
            this.bulletsGroup = this.physics.add.group();

            // Create player
            this.player = this.physics.add.sprite(400, 500, 'ship');
            this.player.setCollideWorldBounds(true);

            // Debug text
            this.debugText = this.add.text(10, 10, 'Lives: 3', { 
                fontSize: '24px', 
                fill: '#ffffff' 
            });

            // Create first asteroid
            this.createAsteroid(3);

            // Collision detection
            this.physics.add.overlap(
                this.player, 
                this.asteroidsGroup, 
                this.hitAsteroid, 
                null, 
                this
            );

            this.physics.add.overlap(
                this.bulletsGroup, 
                this.asteroidsGroup, 
                this.shootAsteroid, 
                null, 
                this
            );

            // Input
            this.cursors = this.input.keyboard.createCursorKeys();
            this.spaceKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);
        }

        update() {
            // Player movement
            if (this.cursors.left.isDown) {
                this.player.x -= 5;
            } else if (this.cursors.right.isDown) {
                this.player.x += 5;
            }

            // Shooting
            if (Phaser.Input.Keyboard.JustDown(this.spaceKey)) {
                this.shootBullet();
            }
        }

        createAsteroid(size, x = null, y = null) {
            // If no position provided, use random screen position
            x = x || Phaser.Math.Between(0, 800);
            y = y || Phaser.Math.Between(0, 300);

            const asteroid = this.asteroidsGroup.create(x, y, 'asteroid');
            asteroid.size = size;
            asteroid.setScale(size / 3);  // Adjust size

            // Random movement
            const speed = 100 * (4 - size);
            const angle = Phaser.Math.DegToRad(Phaser.Math.Between(0, 360));
            asteroid.setVelocity(
                Math.cos(angle) * speed, 
                Math.sin(angle) * speed
            );
        }

        shootBullet() {
            const bullet = this.bulletsGroup.create(this.player.x, this.player.y, 'bullet');
            bullet.setVelocityY(-300);

            // Remove bullet after 2 seconds
            this.time.delayedCall(2000, () => {
                if (bullet.active) bullet.destroy();
            });
        }

        hitAsteroid(player, asteroid) {
            // Reduce lives
            this.lives--;
            this.debugText.setText(`Lives: ${this.lives}`);

            // Destroy asteroid
            asteroid.destroy();

            // Create new asteroid
            this.createAsteroid(3);

            // Check game over
            if (this.lives <= 0) {
                this.scene.restart();
            }
        }

        shootAsteroid(bullet, asteroid) {
            // Destroy bullet and asteroid
            bullet.destroy();
            asteroid.destroy();

            // Split asteroid if not smallest
            if (asteroid.size > 1) {
                this.createAsteroid(asteroid.size - 1, asteroid.x, asteroid.y);
                this.createAsteroid(asteroid.size - 1, asteroid.x, asteroid.y);
            }
        }
    }

    const config = {
        type: Phaser.AUTO,
        width: 800,
        height: 600,
        parent: 'phaser-game',
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 0 },
                debug: true  // Added for easier debugging
            }
        },
        scene: SpaceShooterScene
    };

    const game = new Phaser.Game(config);
    </script>
</body>
</html>
